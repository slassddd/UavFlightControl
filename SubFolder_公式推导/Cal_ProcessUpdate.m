syms dt
syms q0 q1 q2 q3 dax_b day_b daz_b dvx_b dvy_b dvz_b
syms dax day daz dvx dvy dvz
syms daxCov dayCov dazCov dvxCov dvyCov dvzCov
P = sym('P',[22,22]);
P__ = sym('P_x%d_y%d_z',[22 22]);
%% dfdx
            dfdx = [...
                                                                 1,                                              dax_b/2 - dax/2,                                              day_b/2 - day/2,                                              daz_b/2 - daz/2, 0, 0, 0,  0,  0,  0,  q1/2,  q2/2,  q3/2,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                   dax/2 - dax_b/2,                                                            1,                                              daz/2 - daz_b/2,                                              day_b/2 - day/2, 0, 0, 0,  0,  0,  0, -q0/2,  q3/2, -q2/2,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                   day/2 - day_b/2,                                              daz_b/2 - daz/2,                                                            1,                                              dax/2 - dax_b/2, 0, 0, 0,  0,  0,  0, -q3/2, -q0/2,  q1/2,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                   daz/2 - daz_b/2,                                              day/2 - day_b/2,                                              dax_b/2 - dax/2,                                                            1, 0, 0, 0,  0,  0,  0,  q2/2, -q1/2, -q0/2,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 1, 0, 0, dt,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 1, 0,  0, dt,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 1,  0,  0, dt,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
      2*q0*(dvx - dvx_b) - 2*q3*(dvy - dvy_b) + 2*q2*(dvz - dvz_b), 2*q1*(dvx - dvx_b) + 2*q2*(dvy - dvy_b) + 2*q3*(dvz - dvz_b), 2*q1*(dvy - dvy_b) - 2*q2*(dvx - dvx_b) + 2*q0*(dvz - dvz_b), 2*q1*(dvz - dvz_b) - 2*q0*(dvy - dvy_b) - 2*q3*(dvx - dvx_b), 0, 0, 0,  1,  0,  0,     0,     0,     0, - q0^2 - q1^2 + q2^2 + q3^2,           2*q0*q3 - 2*q1*q2,         - 2*q0*q2 - 2*q1*q3, 0, 0, 0, 0, 0, 0
      2*q3*(dvx - dvx_b) + 2*q0*(dvy - dvy_b) - 2*q1*(dvz - dvz_b), 2*q2*(dvx - dvx_b) - 2*q1*(dvy - dvy_b) - 2*q0*(dvz - dvz_b), 2*q1*(dvx - dvx_b) + 2*q2*(dvy - dvy_b) + 2*q3*(dvz - dvz_b), 2*q0*(dvx - dvx_b) - 2*q3*(dvy - dvy_b) + 2*q2*(dvz - dvz_b), 0, 0, 0,  0,  1,  0,     0,     0,     0,         - 2*q0*q3 - 2*q1*q2, - q0^2 + q1^2 - q2^2 + q3^2,           2*q0*q1 - 2*q2*q3, 0, 0, 0, 0, 0, 0
      2*q1*(dvy - dvy_b) - 2*q2*(dvx - dvx_b) + 2*q0*(dvz - dvz_b), 2*q3*(dvx - dvx_b) + 2*q0*(dvy - dvy_b) - 2*q1*(dvz - dvz_b), 2*q3*(dvy - dvy_b) - 2*q0*(dvx - dvx_b) - 2*q2*(dvz - dvz_b), 2*q1*(dvx - dvx_b) + 2*q2*(dvy - dvy_b) + 2*q3*(dvz - dvz_b), 0, 0, 0,  0,  0,  1,     0,     0,     0,           2*q0*q2 - 2*q1*q3,         - 2*q0*q1 - 2*q2*q3, - q0^2 + q1^2 + q2^2 - q3^2, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     1,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     1,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     1,                           0,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           1,                           0,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           1,                           0, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           1, 0, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 1, 0, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 1, 0, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 1, 0, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 1, 0, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 1, 0
                                                                 0,                                                            0,                                                            0,                                                            0, 0, 0, 0,  0,  0,  0,     0,     0,     0,                           0,                           0,                           0, 0, 0, 0, 0, 0, 1];

%% dwdx
            dwdx = [ ...
                (daxCov*q1^2)/4 + (dayCov*q2^2)/4 + (dazCov*q3^2)/4, (dayCov*q2*q3)/4 - (daxCov*q0*q1)/4 - (dazCov*q2*q3)/4, (dazCov*q1*q3)/4 - (dayCov*q0*q2)/4 - (daxCov*q1*q3)/4, (daxCov*q1*q2)/4 - (dayCov*q1*q2)/4 - (dazCov*q0*q3)/4, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
      (dayCov*q2*q3)/4 - (daxCov*q0*q1)/4 - (dazCov*q2*q3)/4,    (daxCov*q0^2)/4 + (dazCov*q2^2)/4 + (dayCov*q3^2)/4, (daxCov*q0*q3)/4 - (dayCov*q0*q3)/4 - (dazCov*q1*q2)/4, (dazCov*q0*q2)/4 - (dayCov*q1*q3)/4 - (daxCov*q0*q2)/4, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
      (dazCov*q1*q3)/4 - (dayCov*q0*q2)/4 - (daxCov*q1*q3)/4, (daxCov*q0*q3)/4 - (dayCov*q0*q3)/4 - (dazCov*q1*q2)/4,    (dayCov*q0^2)/4 + (dazCov*q1^2)/4 + (daxCov*q3^2)/4, (dayCov*q0*q1)/4 - (daxCov*q2*q3)/4 - (dazCov*q0*q1)/4, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
      (daxCov*q1*q2)/4 - (dayCov*q1*q2)/4 - (dazCov*q0*q3)/4, (dazCov*q0*q2)/4 - (dayCov*q1*q3)/4 - (daxCov*q0*q2)/4, (dayCov*q0*q1)/4 - (daxCov*q2*q3)/4 - (dazCov*q0*q1)/4,    (dazCov*q0^2)/4 + (dayCov*q1^2)/4 + (daxCov*q2^2)/4, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                               dvyCov*(2*q0*q3 - 2*q1*q2)^2 + dvzCov*(2*q0*q2 + 2*q1*q3)^2 + dvxCov*(q0^2 + q1^2 - q2^2 - q3^2)^2, dvxCov*(2*q0*q3 + 2*q1*q2)*(q0^2 + q1^2 - q2^2 - q3^2) - dvyCov*(2*q0*q3 - 2*q1*q2)*(q0^2 - q1^2 + q2^2 - q3^2) - dvzCov*(2*q0*q1 - 2*q2*q3)*(2*q0*q2 + 2*q1*q3), dvzCov*(2*q0*q2 + 2*q1*q3)*(q0^2 - q1^2 - q2^2 + q3^2) - dvxCov*(2*q0*q2 - 2*q1*q3)*(q0^2 + q1^2 - q2^2 - q3^2) - dvyCov*(2*q0*q1 + 2*q2*q3)*(2*q0*q3 - 2*q1*q2), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0, dvxCov*(2*q0*q3 + 2*q1*q2)*(q0^2 + q1^2 - q2^2 - q3^2) - dvyCov*(2*q0*q3 - 2*q1*q2)*(q0^2 - q1^2 + q2^2 - q3^2) - dvzCov*(2*q0*q1 - 2*q2*q3)*(2*q0*q2 + 2*q1*q3),                                                               dvxCov*(2*q0*q3 + 2*q1*q2)^2 + dvzCov*(2*q0*q1 - 2*q2*q3)^2 + dvyCov*(q0^2 - q1^2 + q2^2 - q3^2)^2, dvyCov*(2*q0*q1 + 2*q2*q3)*(q0^2 - q1^2 + q2^2 - q3^2) - dvzCov*(2*q0*q1 - 2*q2*q3)*(q0^2 - q1^2 - q2^2 + q3^2) - dvxCov*(2*q0*q2 - 2*q1*q3)*(2*q0*q3 + 2*q1*q2), 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0, dvzCov*(2*q0*q2 + 2*q1*q3)*(q0^2 - q1^2 - q2^2 + q3^2) - dvxCov*(2*q0*q2 - 2*q1*q3)*(q0^2 + q1^2 - q2^2 - q3^2) - dvyCov*(2*q0*q1 + 2*q2*q3)*(2*q0*q3 - 2*q1*q2), dvyCov*(2*q0*q1 + 2*q2*q3)*(q0^2 - q1^2 + q2^2 - q3^2) - dvzCov*(2*q0*q1 - 2*q2*q3)*(q0^2 - q1^2 - q2^2 + q3^2) - dvxCov*(2*q0*q2 - 2*q1*q3)*(2*q0*q3 + 2*q1*q2),                                                               dvxCov*(2*q0*q2 - 2*q1*q3)^2 + dvyCov*(2*q0*q1 + 2*q2*q3)^2 + dvzCov*(q0^2 - q1^2 - q2^2 + q3^2)^2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
                                                           0,                                                      0,                                                      0,                                                      0, 0, 0, 0,                                                                                                                                                                0,                                                                                                                                                                0,                                                                                                                                                                0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
%%
Pnext = dfdx * P__ * (dfdx.') + dwdx;